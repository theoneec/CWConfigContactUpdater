# üîß ConnectWise Configuration Contact Updater

This script connects to the ConnectWise Manage REST API and performs a series of data processing and update tasks to review and correct contact assignments on device configurations.

---

## üìã What It Does

The script performs the following steps:

### **Step 1 ‚Äì Retrieve Configurations**
- Pulls all configurations for a specified company using the provided `CompanyId`.
- Saves the full JSON response for each configuration.
- Exports a flattened snapshot to `step1_config_snapshot.csv`.

### **Step 2 ‚Äì Extract Contact Info from Configurations**
- Loads the JSONs retrieved in Step 1.
- Extracts the `contact.id`, `contact.name`, and `contact._info` values.
- Exports a new enriched CSV (`step2_config_with_contacts.csv`).

### **Step 3 ‚Äì Clean Configuration CSV**
- Cleans up the data for easier processing.
- Extracts only required fields:
  - `id`, `name`, `lastLoginName`, `activeFlag`, `contact.name`, `contact.id`, `contact._info`
- Output saved to: `step3_cleaned_configs.csv`.

### **Step 4 ‚Äì Refresh Company Contacts**
- Queries the ConnectWise API to get **all** company contacts (with paging support).
- Saves to: `step4a_company_contacts.csv`.

### **Step 4B ‚Äì Match Contacts Based on Last Login**
- Attempts to guess contact based on `lastLoginName` using casing rules.
- Compares guessed names against real contacts from Step 4A.
- Outputs a comparison file: `step4b_contact_guess.csv`.

### **Step 5 ‚Äì Update Configurations (Where Needed)**
- For unmatched configurations that have a valid contact match:
  - Updates the configuration‚Äôs assigned contact.
  - PUT request to the ConnectWise API.
  - Uses JSON files generated from Step 2 as base.

### **Step 6 ‚Äì Cleanup**
- Deletes all temporary `.json` and `.csv` files generated by previous steps.

---

## üöÄ Usage

Run the script from PowerShell like so:

```powershell
.\CWConfigContactUpdater.ps1 `
  -CWCompanyId "yourcompanyID" `
  -PublicKey "your_public_key" `
  -PrivateKey "your_private_key" `
  -ClientId "your_client_id" `
  -CompanyId "customercompanyID" `
  -Site "https://api-au.myconnectwise.net" `
  [-ApiVersion "2024.4"] `
  [-BypassBaseUrlCheck]
```

### üß© Parameters

| Parameter            | Required | Description |
|----------------------|----------|-------------|
| `CWCompanyId`        | ‚úÖ       | Your CW Manage company ID |
| `PublicKey`          | ‚úÖ       | Your API public key |
| `PrivateKey`         | ‚úÖ       | Your API private key |
| `ClientId`           | ‚úÖ       | Your registered API client ID |
| `CompanyId`          | ‚úÖ       | The short code (identifier) of the company (e.g., `ZWF`) |
| `Site`               | ‚úÖ       | Base URL of your CW instance (e.g., `https://api-au.myconnectwise.net`) |
| `ApiVersion`         | ‚ùå       | Optional. Defaults to `2025.1`. You can just pass the version number (e.g., `2024.4`) |
| `BypassBaseUrlCheck` | ‚ùå       | Use this switch if you're working with a self-hosted ConnectWise environment |

---

## üõ† Notes

- If the provided `Site` URL does not match known ConnectWise regions (`NA`, `AU`, `EU`), the script will show a warning unless you pass `-BypassBaseUrlCheck`.
- All major steps export intermediate CSVs for visibility and debugging.
- You can safely rerun the script to regenerate outputs or pick up changes.
